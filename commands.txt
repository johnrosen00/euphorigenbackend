setting up network:

docker network create cap21

setting up redis:
docker run -d --name redisServer --network cap21 redis

setting up DB:

docker build -t johnrosen00/cap21db .
docker push johnrosen00/cap21db

*ssh into boulder*
docker rm -f cap21db
docker pull johnrosen00/cap21db
docker run -d --net cap21 -e MYSQL_ROOT_PASSWORD="test" -e MYSQL_DATABASE=store --name cap21db johnrosen00/cap21db

setting up server:

*build.sh*
go clean
go build
docker build -t johnrosen00/cap21api .
go clean

*deploy.sh*
./build.sh
docker push johnrosen00/cap21api
ssh -oStrictHostKeyChecking=no rosenji@boulder.lab.cip.uw.edu 'bash -s' < ./deploy-do.sh


*deploy-do.sh*
docker rm -f cap21api
docker pull johnrosen00/cap21api

export TLSKEY=/etc/letsencrypt/live/api.johnrosen.me/privkey.pem
export TLSCERT=/etc/letsencrypt/live/api.johnrosen.me/fullchain.pem
export REDISADDR="redisServer:6379"
export DSN="root:test@tcp(cap21db:3306)/store"
export SESSIONKEY="bnottomtext"

docker run -d -p 443:443 --net cap21 -v /etc/letsencrypt:/etc/letsencrypt:ro -e REDISADDR=$REDISADDR -e DSN=$DSN -e SESSIONKEY=$SESSIONKEY -e TLSKEY=$TLSKEY -e TLSCERT=$TLSCERT --name cap21api johnrosen00/cap21api



